Origin: http://src.chromium.org/viewvc/chrome/branches/963/src/third_party/libpng/pngrutil.c?view=patch&r1=121492&r2=121491&pathrev=121492
Description: Fix integer issues in a way that caters for both 32-bit and 64-bit
Bug: 112822
Index: libpng-1.2.46/pngrutil.c
===================================================================
--- libpng-1.2.46.orig/pngrutil.c	2011-07-09 05:30:23.000000000 -0500
+++ libpng-1.2.46/pngrutil.c	2012-02-15 21:08:05.000000000 -0600
@@ -363,8 +363,15 @@
       {
          /* Success (maybe) - really uncompress the chunk. */
          png_size_t new_size = 0;
-         png_charp text = png_malloc_warn(png_ptr,
-                        prefix_size + expanded_size + 1);
+         png_charp text = NULL;
+         /* Need to check for both truncation (64-bit platforms) and integer
+          * overflow.
+          */
+         if (prefix_size + expanded_size > prefix_size &&
+             prefix_size + expanded_size < 0xffffffffU)
+         {
+            text = png_malloc_warn(png_ptr, prefix_size + expanded_size + 1);
+         }
 
          if (text != NULL)
          {
